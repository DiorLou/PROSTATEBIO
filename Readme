这是一个前列腺穿刺机器人的上位机测试程序

主要有三部分组成

机器人控制部分:
首先切换到TCP_tip,触碰A点(needle point)和O点(肛门点),保存他们的空间位置;
接着切换到TCP_O(TCP6个值为全0),使用tool坐标系将超声探头插入肛门后,先记录当前的End-Effect点的空间位置;
再点击“获取合适的Tar_Tcp_Z以及更新O点位置”,此举可以计算当前OE向量,并计算该向量在关节六z轴方向的投影,更新最新的O点位置;
此时再点击“设置Cur TCP”(看超声图像部分注意事项),以更改TCP_O的值(重启后还原),此时探头在肛门处的点(新的O点)为RCM点;
然后需要将探头上的超声平面旋转至初始位置,点击“使超声平面对齐AOE平面”,程序使探头绕机械臂末端z轴转动,使超声平面对齐AOE平面;
输入病灶点B点的位置,然后点击“绕OA旋转超声平面使经过B点”,使超声平面检测到B点

超声图像部分：
在探头插入肛门后,在点击“使超声平面对齐AOE平面”之前,需要先扫描前列腺,以确定病灶点的位置;
超声探头需要点击“超声探头左转45度”到达初始位置,再点击“超声探头右转90度”,在右转的过程中,每转1度会保存图片;
图片保存在当前目录的ultrasound_images_{timestamp}文件夹中，图片命名的格式为“当前的旋转度数+机器臂末端位姿(x,y,z,Rx,Ry,Rz)”;
注意:需要在TCP_O(TCP6个值为全0)下后转,上述部分完成之后才能点击“设置Cur TCP”

Beckhoff通信部分:
通过读写倍福变量,写reset变量为一触发reset使穿刺结构到默认位置;
写theta1,theta2数组控制针移动轨迹

点击左转x度时, 记录tcp_e_in_ultrasound_zero_deg 和 计算 volume_in_base, 然后点击 rotate_and_capture_2x, 采集完图像后, 点击 Rotate the ultrasound plane to pass through the puncture point,
这一步会更新 e 点, 转弯后, 更新 tool_pose_in_puncture_position. 然后点击 Read B Points in TCP_U from TXT File, 这一步会根据 tcp_e_in_ultrasound_zero_deg 来计算
Base 系下的 B 点, 更新完后, 会根据 tool_pose_in_puncture_position 以及 Base 系下的 B 点 来计算 需要绕 OA 旋转多少度， 计算每一个 B 点需要绕 OA 旋转的度数.
然后点击 Rotate the ultrasound plane to pass through the biopsy point, 这一步会根据列表中选中的 B point in base 以及当前姿态来计算下一步需要绕 OA 旋转的度数,


点击 ultrasound probe rotate left x Deg 的时候，所有选取的 a_points_in_base 会转化为 a_points_in_volume 然后导出到 A_points_in_volume.txt
超声平面旋转至B点时，会调用 _calculate_and_send_rcm_and_tcp_u_to_nav,
发送组合数据: "index(B点索引), x, y, z(RCM_in_Volume系), rx, ry, rz, rcm_x, rcm_y, rcm_z(TCP_U_in_Volume)"
倍福连接后开始轮询，穿刺机构的位置更新会同时 update_needle_pose_in_volume，
格式化并发送 针尖位姿(Volume系) 到导航服务器。发送格式示例: "UpdateNeedlePoseInVol,Nx,Ny,Nz,Nrx,Nry,Nrz;"